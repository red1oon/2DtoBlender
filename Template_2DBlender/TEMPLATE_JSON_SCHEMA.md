# üìã Template JSON Schema - Complete Field Specifications

**Version:** 1.0
**Date:** 2025-11-24
**Status:** ‚úÖ **COMPLETE - All Required Fields Specified**

---

## üéØ **Purpose**

This document specifies **ALL REQUIRED FIELDS** for the template output JSON and **HOW OCR EXTRACTS** each field from the PDF.

---

## üìê **Complete Template Structure**

```json
{
  "extraction_metadata": { ... },         // OCR metadata (who, when, source)
  "object_selection_preferences": { ... }, // Default preferences (user-editable)
  "extraction_checklist": { ... },        // Systematic checklist (YES/NO/counts)
  "project": { ... },                     // Project details
  "building": { ... },                    // Walls, rooms, structure
  "objects": [ ... ]                      // Object instances with positions
}
```

---

## 1Ô∏è‚É£ **extraction_metadata** (Auto-Generated by OCR)

### **Required Fields:**

| Field | Type | Required | How OCR Fills |
|-------|------|----------|---------------|
| `extracted_by` | String | YES | Hardcoded: `"AI_OCR"` or `"Manual"` |
| `extraction_date` | String | YES | Auto: Current date `"2025-11-24"` |
| `pdf_source` | String | YES | From PDF filename: `"TB-LKTN HOUSE.pdf"` |
| `extraction_version` | String | YES | Hardcoded: `"1.0"` |

### **Example:**
```json
{
  "extraction_metadata": {
    "extracted_by": "AI_OCR",
    "extraction_date": "2025-11-24",
    "pdf_source": "TB-LKTN HOUSE.pdf",
    "extraction_version": "1.0"
  }
}
```

### **OCR Extraction:**
- ‚úÖ `extracted_by`: Hardcoded by OCR script
- ‚úÖ `extraction_date`: `datetime.now().strftime("%Y-%m-%d")`
- ‚úÖ `pdf_source`: `os.path.basename(pdf_path)`
- ‚úÖ `extraction_version`: Hardcoded `"1.0"`

---

## 2Ô∏è‚É£ **object_selection_preferences** (Pre-Loaded, User-Editable)

### **Required Fields:**

| Field | Type | Required | How OCR Fills |
|-------|------|----------|---------------|
| `building_type` | String | YES | OCR infers: `"residential"` or `"commercial"` |
| `design_style` | String | NO | OCR infers: `"modern"`, `"traditional"`, etc. |
| `reference_objects` | Dict | YES | Pre-loaded defaults (31 entries) |

### **Example:**
```json
{
  "object_selection_preferences": {
    "_note": "Edit these preferences to change which objects are selected from library",
    "building_type": "residential",
    "design_style": "modern",
    "reference_objects": {
      "default_toilet": "floor_mounted_toilet_lod300",
      "default_basin": "basin_residential_lod300",
      "default_kitchen_sink": "kitchen_sink_single_bowl",
      "default_door_main": "door_single_900_lod300",
      "default_switch": "switch_1gang_lod300",
      "default_outlet": "outlet_3pin_ms589_lod300",
      ... (31 total)
    }
  }
}
```

### **OCR Extraction:**
- ‚úÖ `building_type`: OCR infers from PDF text:
  - "Residential" ‚Üí `"residential"`
  - "Bungalow" / "House" ‚Üí `"residential"`
  - "Commercial" / "Office" ‚Üí `"commercial"`
- ‚úÖ `design_style`: OCR infers from context (optional)
- ‚úÖ `reference_objects`: **Pre-loaded template** (see OBJECT_SELECTION_GUIDE.md)
  - User can edit to change defaults
  - OCR uses these for object selection

---

## 3Ô∏è‚É£ **extraction_checklist** (Systematic YES/NO/Counts)

### **3.1 project_metadata**

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `name_of_project` | String | YES | TEXT: Title block "TB-LKTN HOUSE" |
| `location_address` | String | YES | TEXT: Address from title block |
| `language` | String | YES | OCR detects: "English" / "Malay" / "Mixed" |
| `number_of_pages` | Int | YES | PDF page count |

**OCR Extraction:**
```python
# Read title block text
title_text = extract_text_from_region(page, title_block_bbox)
if "TB-LKTN" in title_text:
    checklist["project_metadata"]["name_of_project"] = "YES"
```

---

### **3.2 building_structure**

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `floor_plan` | String | YES | TEXT: "Floor Plan" / "Pelan Lantai" found |
| `front_view` | String | YES | TEXT: "Front View" / "Pandangan Hadapan" |
| `side_view` | String | YES | TEXT: "Side View" found (YES/NO) |
| `roof_plan` | String | YES | TEXT: "Roof Plan View" found |
| `section_view` | String | YES | TEXT: "Section" found (YES/NO) |
| `discharge_drain` | String | YES | TEXT: "Discharge Drain" diagram found |
| `residential_function` | String | YES | TEXT: "R" classification in title block |
| `storey_count` | Int | YES | TEXT: "Single Storey" ‚Üí 1, "Double Storey" ‚Üí 2 |

**OCR Extraction:**
```python
# Check for view types
pdf_text = extract_all_text(pdf)
checklist["building_structure"]["floor_plan"] = "YES" if "Floor Plan" in pdf_text else "NO"
checklist["building_structure"]["roof_plan"] = "YES" if "Roof Plan" in pdf_text else "NO"
checklist["building_structure"]["storey_count"] = 1 if "Single Storey" in pdf_text else 2
```

---

### **3.3 dimensions**

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `building_height` | String | YES | TEXT: "3000" / "3.0m" height dimension |
| `building_length` | String | YES | TEXT: "9800" / "9.8m" length dimension |
| `building_breadth` | String | YES | TEXT: "8000" / "8.0m" width dimension |
| `room_dimensions` | String | YES | TEXT: Room labels with dimensions |

**OCR Extraction:**
```python
# Extract dimension text (regex pattern)
height_match = re.search(r'(\d+)\s*mm|(\d+\.\d+)\s*m', dimension_text)
if height_match:
    checklist["dimensions"]["building_height"] = "YES"
```

---

### **3.4 rooms_checklist** (Count per Room Type)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `living_room` | Int | YES | TEXT: "Living Room" / "Ruang Tamu" count |
| `dining_room` | Int | YES | TEXT: "Dining Room" / "Ruang Makan" count |
| `kitchen` | Int | YES | TEXT: "Kitchen" / "Dapur" count |
| `master_bedroom` | Int | YES | TEXT: "Master Bedroom" / "Bilik Tidur Utama" |
| `bedroom_2` | Int | YES | TEXT: "Bedroom 2" / "Bilik Tidur 2" |
| `bedroom_3` | Int | YES | TEXT: "Bedroom 3" count |
| `bedroom_4` | Int | YES | TEXT: "Bedroom 4" count |
| `washroom` | Int | YES | TEXT: "Washroom" / "Bilik Mandi" count |
| `laundry_room` | Int | YES | TEXT: "Laundry" count |
| `store_room` | Int | YES | TEXT: "Store" count |
| `balcony` | Int | YES | TEXT: "Balcony" count |
| `porch` | Int | YES | TEXT: "Porch" count |
| `garage` | Int | YES | TEXT: "Garage" count |

**OCR Extraction:**
```python
# Count room labels
room_mapping = {
    "Living Room": "living_room",
    "Ruang Tamu": "living_room",
    "Kitchen": "kitchen",
    "Dapur": "kitchen",
    "Washroom": "washroom",
    "Bilik Mandi": "washroom"
}

for pdf_text, json_key in room_mapping.items():
    count = pdf_full_text.count(pdf_text)
    checklist["rooms_checklist"][json_key] = count
```

---

### **3.5 architectural_objects** (Counts from Schedules)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `doors_single` | Int | YES | TEXT: Door schedule "Single Door" count |
| `doors_double` | Int | YES | TEXT: Door schedule "Double Door" count |
| `windows_standard` | Int | YES | TEXT: Window schedule count |
| `windows_sliding` | Int | YES | TEXT: "Sliding Window" count |
| `windows_casement` | Int | YES | TEXT: "Casement Window" count |
| `stairs` | Int | YES | TEXT: "Stairs" / "Tangga" found |
| `railings` | Int | YES | TEXT: "Railing" count |

**OCR Extraction:**
```python
# Read door schedule table
door_schedule = extract_table(page, door_schedule_bbox)
single_door_count = sum(1 for row in door_schedule if "Single" in row)
checklist["architectural_objects"]["doors_single"] = single_door_count
```

---

### **3.6 electrical_objects** (Counts from Floor Plan)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `switches_1gang` | Int | YES | TEXT: "Switch" / "Suis" labels count |
| `switches_2gang` | Int | YES | TEXT: "2G Switch" count |
| `switches_3gang` | Int | YES | TEXT: "3G Switch" count |
| `outlets_3pin` | Int | YES | TEXT: "Outlet" / "Alur Kuasa" count |
| `lights_ceiling` | Int | YES | SYMBOL: Circle with "L" label count |
| `lights_wall` | Int | YES | TEXT: "Wall Light" count |
| `lights_pendant` | Int | YES | TEXT: "Pendant" count |
| `fans_ceiling` | Int | YES | SYMBOL: Fan symbol count |
| `fans_exhaust` | Int | YES | TEXT: "Exhaust Fan" count |
| `distribution_board` | Int | YES | TEXT: "DB" label count |

**OCR Extraction:**
```python
# Count electrical labels
switch_labels = ["Switch", "Suis", "1G Switch"]
switch_count = sum(pdf_text.count(label) for label in switch_labels)
checklist["electrical_objects"]["switches_1gang"] = switch_count
```

---

### **3.7 plumbing_fixtures** (Counts from Floor Plan)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `toilets_floor_mounted` | Int | YES | TEXT: "WC" / "Tandas" count |
| `toilets_wall_mounted` | Int | YES | TEXT: "Wall WC" count |
| `toilets_asian` | Int | YES | TEXT: "Asian WC" count |
| `basins_residential` | Int | YES | TEXT: "Basin" / "Singki" count |
| `basins_wall_mounted` | Int | YES | TEXT: "Wall Basin" count |
| `kitchen_sink` | Int | YES | TEXT: "Sink" in kitchen count |
| `showerheads` | Int | YES | TEXT: "Shower" / "Pancuran" count |
| `faucets_basin` | Int | YES | TEXT: "Tap" count (match to basins) |
| `faucets_kitchen` | Int | YES | TEXT: "Tap" in kitchen count |
| `floor_drains` | Int | YES | SYMBOL: "FD" or drain symbol count |
| `water_heaters` | Int | YES | TEXT: "Water Heater" / "WH" count |
| `washing_machine_point` | Int | YES | TEXT: "WM" point count |

**OCR Extraction:**
```python
# Count plumbing labels (multilingual)
wc_labels = ["WC", "Tandas", "Toilet"]
wc_count = sum(pdf_text.count(label) for label in wc_labels)
checklist["plumbing_fixtures"]["toilets_floor_mounted"] = wc_count
```

---

### **3.8 hvac_objects** (Counts from Floor Plan)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `air_conditioners` | Int | YES | TEXT: "AC" / "Air Cond" count |
| `diffusers_supply` | Int | YES | SYMBOL: Square diffuser symbol count |
| `diffusers_return` | Int | YES | TEXT: "Return Grille" count |
| `exhaust_fans` | Int | YES | TEXT: "EF" / "Exhaust Fan" count |

---

### **3.9 kitchen_appliances** (Counts from Floor Plan)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `stove_gas` | Int | YES | TEXT: "Gas Stove" / "Dapur Gas" count |
| `stove_electric` | Int | YES | TEXT: "Electric Stove" count |
| `refrigerator` | Int | YES | TEXT: "Refrigerator" / "Ref" / "Fridge" count |
| `oven` | Int | YES | TEXT: "Oven" count |
| `dishwasher` | Int | YES | TEXT: "Dishwasher" count |
| `range_hood` | Int | YES | TEXT: "Range Hood" / "Hood" count |
| `cabinets_upper` | Int | YES | TEXT: "Upper Cabinet" count |
| `cabinets_lower` | Int | YES | TEXT: "Lower Cabinet" count |

---

### **3.10 furniture_residential** (Counts from Floor Plan)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `beds` | Int | YES | TEXT: "Bed" / "Katil" count |
| `wardrobes` | Int | YES | TEXT: "Wardrobe" / "Almari" count |
| `tables_dining` | Int | YES | TEXT: "Dining Table" count |
| `chairs` | Int | YES | TEXT: "Chair" / "Kerusi" count |
| `sofas` | Int | YES | TEXT: "Sofa" count |
| `shelves` | Int | YES | TEXT: "Shelf" count |

---

### **3.11 external_drainage** (From Roof Plan / Drainage Diagram)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `roof_gutters` | Int | YES | TEXT: "Gutter" / "Pembentung" count |
| `downpipes` | Int | YES | TEXT: "Downpipe" / "DP" count |
| `floor_drains_exterior` | Int | YES | TEXT: "Exterior FD" count |
| `inspection_chambers` | Int | YES | TEXT: "IC" symbol count |

**OCR Extraction (Roof Plan):**
```python
# Read Roof Plan View page
roof_text = extract_text_from_page(roof_plan_page)
gutter_count = roof_text.count("Gutter") + roof_text.count("Pembentung")
checklist["external_drainage"]["roof_gutters"] = gutter_count
```

---

### **3.12 fire_safety** (Optional, Commercial Buildings)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `fire_extinguishers` | Int | NO | SYMBOL: "FE" symbol count |
| `smoke_detectors` | Int | NO | SYMBOL: Detector symbol count |
| `sprinklers` | Int | NO | SYMBOL: Sprinkler symbol count |

---

### **3.13 gas_objects** (Optional)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `gas_meters` | Int | NO | TEXT: "Gas Meter" / "GM" count |
| `gas_pipes` | Int | NO | LINE: Gas pipe route (dashed line) |
| `gas_isolators` | Int | NO | TEXT: "Isolator" count |

---

### **3.14 ict_objects** (Optional)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `data_points` | Int | NO | TEXT: "Data" / "D" point count |
| `telephone_points` | Int | NO | TEXT: "Tel" / "T" point count |
| `tv_points` | Int | NO | TEXT: "TV" point count |
| `cctv_points` | Int | NO | TEXT: "CCTV" count |

---

## 4Ô∏è‚É£ **project** (Project Details)

### **Required Fields:**

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `name` | String | YES | TEXT: Title block project name "TB-LKTN_HOUSE" |
| `drawing_reference` | String | YES | TEXT: Drawing number "WD-1/01" from title block |
| `location` | String | YES | TEXT: Address or "Malaysia" from title block |
| `scale` | Float | YES | TEXT: "Scale 1:100" ‚Üí `1.0` (normalized) |
| `units` | String | YES | TEXT: "mm" / "m" ‚Üí `"meters"` (convert to meters) |

**OCR Extraction:**
```python
# Read title block
title_block = extract_text_from_region(page, title_block_bbox)
name = re.search(r'([A-Z\-]+\s+HOUSE)', title_block).group(1)
drawing_ref = re.search(r'(WD-\d+/\d+)', title_block).group(1)
project["name"] = name
project["drawing_reference"] = drawing_ref
project["location"] = "Malaysia"  # Default or extract from address field
project["scale"] = 1.0
project["units"] = "meters"
```

---

## 5Ô∏è‚É£ **building** (Walls, Rooms, Structure)

### **5.1 walls** (Array of Wall Objects)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `name` | String | YES | Generated: `"north_wall"`, `"south_wall"`, etc. |
| `start` | [Float, Float] | YES | TEXT: Grid line intersection coordinates |
| `end` | [Float, Float] | YES | TEXT: Grid line end coordinates |

**OCR Extraction:**
```python
# Extract grid lines and wall positions
grid_lines = extract_grid_lines(floor_plan_page)
walls = []
for i, line in enumerate(grid_lines):
    walls.append({
        "name": f"{direction}_wall_{i}",
        "start": [line.x1, line.y1],
        "end": [line.x2, line.y2]
    })
building["walls"] = walls
```

---

### **5.2 rooms** (Array of Room Objects)

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `name` | String | YES | TEXT: "Living Room" label from floor plan |
| `vertices` | Array | YES | POLYGON: Room boundary coordinates |
| `entrance` | [Float, Float] | YES | DOOR: Door position = entrance point |

**OCR Extraction:**
```python
# Find room labels and boundaries
room_labels = extract_text_positions(floor_plan_page, room_keywords)
for label in room_labels:
    room_name = label.text  # "Living Room"
    room_center = [label.x, label.y]

    # Trace room boundary (polygon)
    boundary = trace_room_boundary(floor_plan_page, room_center)

    # Find entrance (door position)
    entrance = find_door_nearest_to_room(room_center)

    rooms.append({
        "name": room_name.lower().replace(" ", "_"),
        "vertices": boundary,
        "entrance": entrance
    })
building["rooms"] = rooms
```

---

## 6Ô∏è‚É£ **objects** (Array of Object Instances)

### **Required Fields per Object:**

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `object_type` | String | YES | MAP: PDF text ‚Üí Library object (see mapping table) |
| `position` | [Float, Float, Float] | YES | TEXT: Label coordinates on floor plan |
| `name` | String | YES | TEXT: Object label ("D1", "Switch", "WC") |
| `room` | String | YES | SPATIAL: Which room contains this position |

### **Optional Fields:**

| Field | Type | Required | How OCR Extracts from PDF |
|-------|------|----------|---------------------------|
| `dimensions` | Dict | NO | TEXT: From schedule ("900√ó2100") |
| `rotation` | Float | NO | GEOMETRIC: Wall-normal direction (auto-calculated) |
| `quantity` | Int | NO | TEXT: Schedule "Qty" column |

---

### **OCR Extraction (Complete Example):**

```python
# 1. Extract door schedule
door_schedule = extract_table(page, "DOOR SCHEDULE")
# Returns: [{"mark": "D1", "size": "900√ó2100", "type": "Single Door", "qty": 3}]

# 2. Find "D1" labels on floor plan
d1_positions = find_text_positions(floor_plan_page, "D1")
# Returns: [(2.0, 0.1), (6.0, 0.1), (8.0, 2.1)]

# 3. Map to library object
text_mapping = {"D1: 900√ó2100 Single Door": "door_single_900_lod300"}
library_object = text_mapping["D1: 900√ó2100 Single Door"]

# 4. Determine room (spatial query)
for pos in d1_positions:
    room = find_room_containing_point(rooms, pos)

    objects.append({
        "object_type": library_object,
        "position": [pos[0], pos[1], 0.0],
        "name": "D1",
        "room": room,
        "dimensions": {"width": 0.9, "height": 2.1},
        "quantity": 1
    })
```

---

### **Object Extraction Flow:**

```
Step 1: Read Schedule Tables
   ‚Üì
Extract: Marks, Sizes, Types, Quantities

Step 2: Find Labels on Floor Plan
   ‚Üì
Extract: Text positions (X, Y coordinates)

Step 3: Map to Library Objects
   ‚Üì
Lookup: PDF text ‚Üí Library object_type (dictionary)

Step 4: Determine Room Assignment
   ‚Üì
Spatial Query: Which room polygon contains this point?

Step 5: Fill Template JSON
   ‚Üì
Create: Object entry with all required fields
```

---

## ‚úÖ **Validation Checklist**

### **Required Sections:**
- [ ] `extraction_metadata` - All 4 fields filled
- [ ] `object_selection_preferences` - Pre-loaded defaults
- [ ] `extraction_checklist` - All 14 categories filled
- [ ] `project` - All 5 fields filled
- [ ] `building` - Walls and rooms arrays populated
- [ ] `objects` - All object instances with required fields

### **Required Fields per Object:**
- [ ] `object_type` - Mapped from library
- [ ] `position` - [X, Y, Z] coordinates
- [ ] `name` - Identifier (from PDF label)
- [ ] `room` - Spatial assignment

---

## üîë **Key Points**

### **1. Text-Based Extraction (NO Image Recognition):**
- ‚úÖ Read TEXT labels ("D1", "Switch", "WC")
- ‚úÖ Read TEXT dimensions ("9.8m", "3000mm")
- ‚úÖ Read TEXT schedules (tables with marks, sizes, quantities)
- ‚úÖ Extract TEXT positions (coordinates on PDF page)
- ‚ùå NO visual recognition of shapes/objects

### **2. Dictionary Mapping:**
- ‚úÖ "D1: 900√ó2100 Single Door" ‚Üí `door_single_900_lod300`
- ‚úÖ "Switch" / "Suis" ‚Üí `switch_1gang_lod300`
- ‚úÖ "Roof Tile" ‚Üí `roof_tile_9.7x7_lod300`
- See: `PDF_TEXT_TO_OBJECT_MAPPING.md` for complete table

### **3. Checklist-Driven:**
- ‚úÖ OCR loads pre-defined checklist (80+ items)
- ‚úÖ Systematically ticks YES/NO/count for each category
- ‚úÖ Prevents omissions (structured questionnaire)

### **4. Spatial Assignment:**
- ‚úÖ Room assignment by geometric containment
- ‚úÖ Wall assignment by nearest-neighbor
- ‚úÖ Entrance detection from door positions

---

## üìö **Reference Documents**

1. **OCR_TEXT_ONLY_APPROACH.md** - Text-based extraction methodology
2. **PDF_TEXT_TO_OBJECT_MAPPING.md** - Complete text-to-object mapping table (100+ entries)
3. **OBJECT_SELECTION_GUIDE.md** - Default preferences (31 reference objects)
4. **TB_LKTN_COMPLETE_template.json** - Example template (57 objects, complete)

---

## üéØ **Summary**

**This document specifies:**
1. ‚úÖ ALL required template JSON fields (6 sections, 80+ fields)
2. ‚úÖ HOW OCR extracts each field from PDF (text-based)
3. ‚úÖ Validation checklist for completeness
4. ‚úÖ Complete extraction workflow

**Result:** OCR knows EXACTLY what to extract and how to fill the template.

---

**Generated:** 2025-11-24
**Status:** ‚úÖ **COMPLETE - All Fields Specified**
**Purpose:** Complete JSON schema for OCR implementation

**Template structure is now FULLY DEFINED!** üöÄ
