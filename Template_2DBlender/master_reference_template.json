{
  "_description": "Master Reference Template - High-level instruction set for OCR extraction",
  "_note": "PERMANENT REFERENCE - Never modified. OCR reads sequentially to know what to search for.",
  "_architecture": "Two-tier system: This JSON contains high-level instructions â†’ vector_patterns.py executes low-level pattern matching",

  "extraction_sequence": [
    {
      "_phase": "1B_calibration",
      "_dependency": "FIRST - establishes scale for all coordinate transforms",
      "item": "Outer Discharge Drain",
      "detection_id": "CALIBRATION_DRAIN_PERIMETER",
      "search_text": ["DISCHARGE"],
      "pages": [1, 2, 6, 7],
      "object_type": "roof_gutter_100_lod300",
      "code_ref": "CalibrationEngine.extract_drain_perimeter()",
      "outputs": ["scale_x", "scale_y", "offset_x", "offset_y", "confidence"]
    },

    {
      "_phase": "1D_elevations",
      "_dependency": "Needed for wall heights, window sill heights, door heights",
      "item": "Floor Level (FFL)",
      "detection_id": "ELEVATION_TEXT_REGEX",
      "search_text": ["FFL", "FLOOR LEVEL", "FINISHED FLOOR LEVEL"],
      "pages": [3, 4],
      "regex_patterns": ["FFL\\s*\\+?\\s*(\\d+\\.?\\d*)\\s*m", "FFL\\s*\\+?\\s*(\\d+)\\s*mm"],
      "object_type": null,
      "code_ref": "ElevationExtractor.extract_from_page()",
      "outputs": ["floor_level"]
    },

    {
      "_phase": "1D_elevations",
      "item": "Lintel Level",
      "detection_id": "ELEVATION_TEXT_REGEX",
      "search_text": ["LINTEL", "DOOR HEAD"],
      "pages": [3, 4],
      "regex_patterns": ["LINTEL.*?(\\d+\\.?\\d*)\\s*m", "LINTEL.*?(\\d+)\\s*mm"],
      "object_type": null,
      "outputs": ["lintel_level"]
    },

    {
      "_phase": "1D_elevations",
      "item": "Ceiling Level",
      "detection_id": "ELEVATION_TEXT_REGEX",
      "search_text": ["CEILING", "SOFFIT", "ROOF LEVEL"],
      "pages": [3, 4],
      "regex_patterns": ["CEILING.*?(\\d+\\.?\\d*)\\s*m", "CEILING.*?(\\d+)\\s*mm"],
      "object_type": null,
      "outputs": ["ceiling_level"]
    },

    {
      "_phase": "1D_elevations",
      "item": "Window Sill Height",
      "detection_id": "ELEVATION_TEXT_REGEX",
      "search_text": ["SILL", "W/S", "WINDOW SILL"],
      "pages": [3, 4],
      "regex_patterns": ["SILL.*?(\\d+\\.?\\d*)\\s*m", "W/?S.*?(\\d+\\.?\\d*)\\s*m"],
      "object_type": null,
      "outputs": ["window_sill"]
    },

    {
      "_phase": "1A_schedules",
      "_dependency": "Needed for door/window dimensions before position detection",
      "item": "Door Schedule",
      "detection_id": "SCHEDULE_TABLE_EXTRACTION",
      "search_text": ["DOOR SCHEDULE", "PINTU"],
      "pages": [1, 2],
      "table_headers": ["TYPE", "SIZE", "WIDTH", "HEIGHT", "QUANTITY"],
      "object_type": null,
      "code_ref": "ScheduleExtractor.extract_door_schedule()",
      "outputs": ["door_schedule"]
    },

    {
      "_phase": "1A_schedules",
      "item": "Window Schedule",
      "detection_id": "SCHEDULE_TABLE_EXTRACTION",
      "search_text": ["WINDOW SCHEDULE", "TINGKAP"],
      "pages": [1, 2],
      "table_headers": ["TYPE", "SIZE", "WIDTH", "HEIGHT", "QUANTITY"],
      "object_type": null,
      "code_ref": "ScheduleExtractor.extract_window_schedule()",
      "outputs": ["window_schedule"]
    },

    {
      "_phase": "1C_walls",
      "_dependency": "Needs calibration for coordinate transform",
      "item": "Walls (interior)",
      "detection_id": "WALL_VECTOR_LINES",
      "search_text": null,
      "pages": [1],
      "vector_pattern": "continuous_lines",
      "object_type": "wall_lightweight_100_lod300",
      "code_ref": "WallDetector.extract_from_vectors()",
      "outputs": ["internal_walls"]
    },

    {
      "_phase": "1C_walls",
      "item": "Walls (exterior)",
      "detection_id": "BUILDING_PERIMETER",
      "search_text": null,
      "pages": [1],
      "vector_pattern": "building_envelope",
      "object_type": "wall_brick_3m_lod300",
      "outputs": ["outer_walls"]
    },

    {
      "_phase": "2_openings",
      "_dependency": "Needs schedule for dimensions, calibration for position",
      "item": "Doors (single)",
      "detection_id": "TEXT_LABEL_SEARCH",
      "search_text": ["D1", "D2", "D3", "D4", "D5"],
      "pages": [1],
      "object_type": "door_single_900_lod300",
      "code_ref": "OpeningDetector.extract_door_positions()",
      "outputs": ["doors"]
    },

    {
      "_phase": "2_openings",
      "item": "Windows",
      "detection_id": "TEXT_LABEL_SEARCH",
      "search_text": ["W1", "W2", "W3", "W4", "W5"],
      "pages": [1],
      "object_type": "window_aluminum_2panel_1200x1000_lod300",
      "code_ref": "OpeningDetector.extract_window_positions()",
      "outputs": ["windows"]
    },

    {
      "_phase": "3_electrical",
      "_dependency": "Needs calibration for position",
      "item": "Switches (1-gang)",
      "detection_id": "TEXT_MARKER_WITH_SYMBOL",
      "search_text": ["SWS", "SW", "S"],
      "pages": [1],
      "symbol_pattern": "small_circle_or_square_on_wall",
      "object_type": "switch_1gang_lod300",
      "height_rule": "1.2m_from_floor",
      "outputs": ["switches"]
    },

    {
      "_phase": "3_electrical",
      "item": "Outlets (3-pin)",
      "detection_id": "TEXT_MARKER_WITH_SYMBOL",
      "search_text": ["PP", "P", "OUTLET"],
      "pages": [1],
      "symbol_pattern": "small_circle_or_square_on_wall",
      "object_type": "outlet_3pin_ms589_lod300",
      "height_rule": "0.3m_from_floor",
      "outputs": ["outlets"]
    },

    {
      "_phase": "3_electrical",
      "item": "Ceiling Lights",
      "detection_id": "TEXT_MARKER_WITH_SYMBOL",
      "search_text": ["LC", "L", "LIGHT"],
      "pages": [1],
      "symbol_pattern": "circle_with_cross_in_room_center",
      "object_type": "ceiling_light_surface_lod300",
      "height_rule": "ceiling_height",
      "outputs": ["lights"]
    },

    {
      "_phase": "3_electrical",
      "item": "Ceiling Fans",
      "detection_id": "TEXT_MARKER_WITH_SYMBOL",
      "search_text": ["CF", "FAN"],
      "pages": [1],
      "symbol_pattern": "circle_with_blades_in_room_center",
      "object_type": "ceiling_fan_3blade_lod300",
      "height_rule": "ceiling_height",
      "outputs": ["fans"]
    },

    {
      "_phase": "4_plumbing",
      "_dependency": "Needs calibration + room correlation",
      "item": "Toilet (floor-mounted)",
      "detection_id": "TOILET_BOWL_COMBO",
      "search_text": ["WC", "wc", "TOILET"],
      "pages": [1],
      "vector_pattern": "ellipse_plus_trapezoid",
      "correlation_rule": "text_marker_within_5m_AND_in_same_room",
      "object_type": "floor_mounted_toilet_lod300",
      "validation": "must_have_WC_text_in_room",
      "outputs": ["toilets"]
    },

    {
      "_phase": "4_plumbing",
      "item": "Basin (residential)",
      "detection_id": "BASIN_SYMBOL",
      "search_text": ["BASIN", "SINK", "WASH"],
      "pages": [1],
      "vector_pattern": "circle_or_oval_with_faucet_mark",
      "object_type": "basin_residential_lod300",
      "smart_selection": "prefer_round_for_washroom",
      "outputs": ["basins"]
    },

    {
      "_phase": "4_plumbing",
      "item": "Kitchen Sink",
      "detection_id": "SINK_SYMBOL",
      "search_text": ["SINK", "KITCHEN"],
      "pages": [1],
      "vector_pattern": "rectangle_with_divider_line",
      "object_type": "kitchen_sink_single_bowl_lod200",
      "room_constraint": "must_be_in_kitchen",
      "smart_selection": "prefer_sink_with_drainboard",
      "outputs": ["sinks"]
    },

    {
      "_phase": "4_plumbing",
      "item": "Showerhead",
      "detection_id": "SHOWER_SYMBOL",
      "search_text": ["SHOWER", "SH"],
      "pages": [1],
      "vector_pattern": "circle_with_spray_lines",
      "object_type": "showerhead_fixed_lod200",
      "room_constraint": "must_be_in_washroom",
      "outputs": ["showers"]
    },

    {
      "_phase": "4_plumbing",
      "_note": "Floor drain detection pending - no suitable library object found",
      "item": "Floor Drain",
      "detection_id": "DRAIN_SYMBOL",
      "search_text": ["FD", "FLOOR DRAIN", "DRAIN"],
      "pages": [1],
      "vector_pattern": "small_circle_with_cross",
      "object_type": null,
      "outputs": ["floor_drains"]
    },

    {
      "_phase": "5_built_ins",
      "_dependency": "Needs walls and room definitions",
      "item": "Kitchen Cabinets (base)",
      "detection_id": "CABINET_VECTOR_PATTERN",
      "search_text": ["CABINET", "KB"],
      "pages": [1],
      "vector_pattern": "continuous_rectangles_along_wall",
      "object_type": "kitchen_base_cabinet_900_lod300",
      "room_constraint": "must_be_in_kitchen",
      "outputs": ["cabinets_base"]
    },

    {
      "_phase": "5_built_ins",
      "item": "Kitchen Cabinets (wall)",
      "detection_id": "CABINET_VECTOR_PATTERN",
      "search_text": ["WALL CABINET", "WC"],
      "pages": [1],
      "vector_pattern": "dashed_rectangles_along_wall",
      "object_type": "kitchen_wall_cabinet_900_lod300",
      "room_constraint": "must_be_in_kitchen",
      "height_rule": "2.0m_from_floor",
      "outputs": ["cabinets_wall"]
    },

    {
      "_phase": "6_furniture",
      "_dependency": "LAST - placed after rooms are built",
      "item": "Bed (queen)",
      "detection_id": "FURNITURE_RECTANGLE_WITH_TEXT",
      "search_text": ["BED", "KATIL"],
      "pages": [1],
      "vector_pattern": "large_rectangle_in_bedroom",
      "object_type": "bed_queen_lod300",
      "room_constraint": "must_be_in_bedroom",
      "smart_selection": "queen_for_master_bedroom",
      "outputs": ["beds"]
    },

    {
      "_phase": "6_furniture",
      "item": "Wardrobe",
      "detection_id": "FURNITURE_RECTANGLE_WITH_TEXT",
      "search_text": ["WARDROBE", "WR", "ALMARI"],
      "pages": [1],
      "vector_pattern": "tall_rectangle_against_wall",
      "object_type": "wardrobe_double_lod300",
      "alternative_types": ["furniture_wardrobe"],
      "room_constraint": "must_be_in_bedroom",
      "outputs": ["wardrobes"]
    },

    {
      "_phase": "6_furniture",
      "item": "Dining Table",
      "detection_id": "FURNITURE_RECTANGLE_WITH_TEXT",
      "search_text": ["TABLE", "DINING", "MEJA"],
      "pages": [1],
      "vector_pattern": "rectangle_in_dining_area",
      "object_type": "table_dining_1500x900_lod300",
      "alternative_types": ["dining_table_6seat"],
      "room_constraint": "living_room_or_dining_room",
      "outputs": ["tables"]
    },

    {
      "_phase": "6_furniture",
      "item": "Sofa",
      "detection_id": "FURNITURE_RECTANGLE_WITH_TEXT",
      "search_text": ["SOFA"],
      "pages": [1],
      "vector_pattern": "long_rectangle_in_living_room",
      "object_type": "sofa_3seater_lod300",
      "alternative_types": ["sofa_2seater_lod300"],
      "room_constraint": "must_be_in_living_room",
      "outputs": ["sofas"]
    },

    {
      "_phase": "6_furniture",
      "item": "TV Console",
      "detection_id": "FURNITURE_RECTANGLE_WITH_TEXT",
      "search_text": ["TV", "TELEVISION"],
      "pages": [1],
      "vector_pattern": "medium_rectangle_against_wall",
      "object_type": "tv_console_1500_lod300",
      "room_constraint": "must_be_in_living_room",
      "smart_selection": "include_tv_flatscreen_40inch",
      "outputs": ["tv_consoles"]
    },

    {
      "_phase": "6_furniture",
      "item": "Coffee Table",
      "detection_id": "FURNITURE_RECTANGLE_WITH_TEXT",
      "search_text": ["COFFEE TABLE", "TABLE"],
      "pages": [1],
      "vector_pattern": "small_rectangle_in_living_room",
      "object_type": "coffee_table",
      "room_constraint": "must_be_in_living_room",
      "outputs": ["coffee_tables"]
    },

    {
      "_phase": "3_electrical",
      "item": "TV/ICT Point",
      "detection_id": "TEXT_MARKER_WITH_SYMBOL",
      "search_text": ["TV", "ICT", "DATA"],
      "pages": [1],
      "symbol_pattern": "small_square_on_wall",
      "object_type": "ict_tv_point",
      "height_rule": "0.3m_from_floor",
      "room_constraint": "living_room_or_bedroom",
      "outputs": ["ict_tv_points"]
    },

    {
      "_phase": "6_furniture",
      "_note": "Refrigerator detection pending - no suitable library object found",
      "item": "Refrigerator",
      "detection_id": "APPLIANCE_RECTANGLE_WITH_TEXT",
      "search_text": ["REF", "FRIDGE", "REFRIGERATOR"],
      "pages": [1],
      "vector_pattern": "tall_rectangle_in_kitchen",
      "object_type": null,
      "room_constraint": "must_be_in_kitchen",
      "outputs": ["refrigerators"]
    },

    {
      "_phase": "6_furniture",
      "_note": "Stove detection pending - no suitable library object found",
      "item": "Stove",
      "detection_id": "APPLIANCE_SYMBOL",
      "search_text": ["STOVE", "COOKER", "DAPUR"],
      "pages": [1],
      "vector_pattern": "square_with_burner_circles",
      "object_type": null,
      "room_constraint": "must_be_in_kitchen",
      "outputs": ["stoves"]
    }
  ]
}
